{"config":{"lang":["en"],"separator":"[\\s\\-]+","pipeline":["stopWordFilter"]},"docs":[{"location":"","title":"Exploration of Electron Density and Cryo-EM Potential","text":"<p>in ultra-high resolution protein structures and a geometric analysis for criteria searching of density areas of interest </p> <p>The primary purpose of my PhD is to look for new information about interatomic bonds from ultra-high resolution x-ray crystallographic maps. The explosion in the solutions of ultra-high resolution structures has led to information about protein crystal structures being sampled up to every 0.3\u00c5 in ultra-high structures.  With the distances in the peptide bond between atoms being around 1.45\u00c5 (Engh&amp;Huber, 2006) this is an opportunity to analyse data sampled within atomic bonds for new informaiton.  </p>"},{"location":"#the-density-in-a-peptide-bond","title":"The density in a peptide bond","text":"<p>An example of an image of some electron density, where the red is a stronger density. This is a peptide bond with the C in the middle, the peptide bond to N+1 mid left, the O on the right.</p> <p> </p>"},{"location":"#status-notes","title":"Status notes","text":""},{"location":"#291224","title":"29/12/24","text":"<ul> <li>I have done more than expected and re-implemeted critical point analysis as a new derivative called  criticalpoint that categorises a critical point based on the signs of the 2nd partial derivatives as per Bader (1994).  </li> <li>All not complete pages I asterisked at the end* but didn't want to remove because they guide me.  </li> </ul>"},{"location":"#251224","title":"25/12/24","text":"<p>This is under development to write up my current progress, nothing is complete currently it is all notes to self.  </p>"},{"location":"about/","title":"About me","text":"<ul> <li>Orcid </li> <li>GitHub </li> </ul> <p>I am a Research Software Engineer at the Institute of Cancer Research, doing a PhD in ultra-high resolution crystallographic protein structures at Birkbeck College (UoL) in my spare time.  </p> <p>Having been a programmer in banking for many years, and then a secondary school maths teacher, I discovered the academic world a bit too late. It was prompted by becoming the primary carer for my daughter with type 1 diabetes and googling related programming jobs - thus finding Bioinformatics. With no Biology at all, I launched into an MSc in Bioinformatics at Birkbeck College, and then, needing proper money, started a PhD in my spare time and a full time job.  </p> <p>My PhD work is for the sheer fun of it, so is progressing slowly and is a bit tangential. My interests are in mathematical methods and analysis of spatial data; the meaning of experimental evidence and the evidence for protein geoemetry; and the extent to which information is meaningful.  Having invented an interpolation algorithm when I was a teenager I can't resist using it even though there are better ones.  </p>"},{"location":"references/","title":"References","text":"<p>Afonine, P. V., Lunin, V. Y., Muzet, N., &amp; Urzhumtsev, A. (2004). On the possibility of the observation of valence electron density for individual bonds in proteins in conventional difference maps. Acta Crystallographica Section D Biological Crystallography, 60(2), 260\u2013274. https://doi.org/10.1107/S0907444903026209  </p> <p>Bader, R. F. W. (1994). Atoms in molecules: A quantum theory. Clarendon Press ; Oxford University Press.  </p> <p>Clabbers, M.T.B., Martynowycz, M.W., Hattne, J., Gonen, T. (2022) Hydrogens and hydrogen-bond networks in macromolecular MicroED data. J Struct Biol X 6: 100078-100078  </p> <p>Engh, R. A., &amp; Huber, R. (2006). 18.3. Structure quality and target parameters. International Tables for Crystallography, F, 382\u2013392. http://dx.doi.org/10.1107/97809553602060000695  </p> <p>Glover, I., Haneef I., Pitts, J., Wood, S., Moss, D., Tickle, I., Blundell, T. (1983). Conformational flexibility in a small globular hormone: x-ray analysis of avian pancreatic polypeptide at 0.98-A resolution. Biopolymers 22 293-304 DOI: 10.1002/bip.360220138  </p> <p>Jelsch, C., Teeter, M. M., Lamzin, V., Pichon-Pesme, V., Blessing, R. H., &amp; Lecomte, C. (2000). Accurate protein crystallography at ultra-high resolution: Valence electron distribution in crambin. Proceedings of the National Academy of Sciences, 97(7), 3171\u20133176. https://doi.org/10.1073/pnas.97.7.3171  </p> <p>Leiger, K., Linnanto, J.M., R\u00e4tsep, M., Timpmann, K., Ashikhmin, A.A., Moskalenko, A.A., Fufina, T.Y., Gabdulkhakov, A.G., and Freiberg, A.. Controlling Photosynthetic Excitons by Selective Pigment Photooxidation. The Journal of Physical Chemistry B 2019 123 (1), 29-38. DOI: 10.1021/acs.jpcb.8b08083  </p> <p>Lonsdale, K. (1931). An X-ray Analysis of the Structure of Hexachlorobenzene, using the Fourier Method. Royal Society. https://royalsocietypublishing.org/doi/pdf/10.1098/rspa.1931.0166  </p> <p>Ramachandran, G. N., Ramakrishnan, C., &amp; Sasisekharan, V. (1963). Stereochemistry of polypeptide chain configurations. Journal of Molecular Biology, 7(1), 95\u201399. https://doi.org/10.1016/S0022-2836(63)80023-6  </p> <p>Schmidt A, Teeter M, Weckert E, Lamzin VS . (2011) Crystal structure of small protein crambin at 0.48\u2005\u00c5 resolution. Acta Crystallogr Sect F Struct Biol Cryst Commun 67 424-8 (2011), 10.1107/S1744309110052607.  </p> <p>Wlodawer, A. (2007). Stereochemistry and Validation of Macromolecular Structures. Methods Molecular Biology, 1607, 68\u201375. https://doi.org/10.1007/978-1-4939-7000-1  </p>"},{"location":"todo/","title":"To do","text":"<ul> <li>Util Make a util that takes a pdb file and returns the same but all the atom positions adjusted to the maxima  </li> <li>Analysis Use this to run the analysis for C:O against CA:C:N+1 (tau+1) and show no correlation in pdb but correlation on adjusted maxima</li> <li> <p>N.b. I have this in C++ but not sure about python. Do I want to use my C++ tool or re-write?  Could I make it a singularity image?</p> </li> <li> <p>Util make a util that returns  </p> </li> <li>a) the coords of structures with similar features (pdb search)  </li> <li>b) the adjusted maxima of those  </li> <li>c) Superposes either adjusted or none adjusted slices  </li> <li> <p>Analysis use this to look at hydrogen bonds mentioned in lit review</p> </li> <li> <p>Analysis iron in different formations</p> </li> <li> <p>Analysis and Util is my Laplacian calculation correct? I had a hessian before which I lost, in part because the method I used disappeared from the internet, resurrect all of that and ensure correctness. Use this to re-analyse 6jgj.  </p> </li> </ul>"},{"location":"assets/readme/","title":"Readme","text":"<p>Just temp for upload</p>"},{"location":"geometry/overview/","title":"Protein Geometry","text":"<p>Traditionally protein geometry is analysed based on Engh&amp;Huber (2006) bond lengths,  hydrogen bond lengths, and the Ramchandran plot (Ramachandran et al, 1963).</p> <p>Given the geometric nature of protein structures and the adherence to stereochemistry  in bond lengths, there are correlations that can be predicted and measured that have a  more regular appearance than the Ramachandran plot. These regular correlations may not add new information, being formed effectively as an output of the decisions made in  the input of the restraints used in the solution of the protein structures.  However, when coupled with the question of experimental evidence the adherence  or non-adherence to expected geometric restraints is more interesting.</p> <p>An example is the correlation between psi (N:CA:C:N+1) and the atom distance N:O.  </p>"},{"location":"geometry/overview/#psi-and-no-with-resolution-as-hue","title":"PSI and N:O with resolution as hue","text":"<p> This image shows a clear geometric sine-like correlation between the dihedral angle PSI  (N:CA:C:N+1) and the 3-atom distance N:O.  This is not so surprising if you consider that  PSI is a twist around the CA:C bond so the N+1 and O move respectively to the N  through the rotation.  </p>"},{"location":"geometry/overview/#psi-and-no-with-tau-as-hue","title":"PSI and N:O with TAU as hue","text":"<p> This is more interesting, as we can see here a clear relationship with TAU - the angle  of the backbone between atoms N:CA:C which remains elusive to analysis across literature. This is a clear relationship, and explicable if you think about the pressure that the  atoms come under during the rotation - however it is not a geometric relationship but one  that suggests the forces on the atoms.  </p>"},{"location":"geometry/overview/#an-atom-picture-to-help","title":"An atom picture to help","text":"<p>The amino acids as diagrams with the atom names described  here at imgt.org</p>"},{"location":"geometry/overview/#cbo-and-no-with-psi-as-the-hue","title":"CB:O and N:O - with PSI as the hue","text":"<p> Similar to the relationship with N:O we have CB where there is a CB (exc GLY) which is  also a 3 atom distance from O and rotates relative to O in the same way as N, giving a  sinusoidal relationship also between CB:O and N:O.  When looking at this wrt to that relationship with PSI as the hue a relationship is clear.  We might start to ask questions, like the 6 observations with a CB:O distance near 3.6\u00c5.  </p>"},{"location":"geometry/overview/#cbo-and-no-with-amino-acid-as-the-hue","title":"CB:O and N:O - with amino acid as the hue","text":"<p>My immediate guess would be proline, either as the amino acid or before or after,  but a using the motif of amino acids either side as the hue it doesn't show anything  obvious so I leave that unanswered for now. </p>"},{"location":"geometry/overview/#colab-page-to-replicate","title":"Colab Page to replicate","text":"<p>All the plots can be run from the colab example found here:  colab-geometry-intro</p>"},{"location":"geometry/prometry/","title":"Prometry Web Application","text":"<p>The prometry web application provides a basic interface onto the prometry python library to enable  manual exploration of correlations, contacts etc.  A more sophisticated interaction would  require coding, ie exploration of a large number of pdbs would be time consuming and  not approriate for a freely-hosted web app.</p> <p>In addition there is the ability to search the EBI for solved structures based on gene  and organism in order to make it easier to run the library on structures of interest.</p> <p>This is particularly helpful for finding AlphaFold structures that do not  adhere to stereochemical expectations \ud83d\ude05</p> <p>The functionality provided in this app is:</p>"},{"location":"geometry/prometry/#structure-search","title":"Structure Search","text":"<p>A quick way to find relevant structures using the Uniprot api calls. The AlphaFold  structures both reviewed and unreviewed are given first, followed by the solved structures and  some relevant info. These pdb codes can be used further in the app.  </p> <p></p> <p></p>"},{"location":"geometry/prometry/#correlation","title":"Correlation","text":"<p>This is the main use of the app, to visualise correlations.  Using some of the TP53 structures above: <code>9C5S 3D06 5MHC 8UQR 6GGC 6SHZ 4MZI 6GGE 3LW1 5O1E 6RL3 8E7A</code></p> <p></p>"},{"location":"geometry/prometry/#contact-maps","title":"Contact Maps","text":"<p>A CA-CA contact map for the same TP53 structures, with the hue of both the CA distance  and the amino acid. The distance is restriained to between 0.5 and 15\u00c5.  </p> <p>  .</p>"},{"location":"geometry/prometry/#3d-space","title":"3d Space","text":"<p>For looking at the atoms of a structure in 3d space the AlphaFold structures can be more  fun, so this is the TP53 structure AF-P04637-F1-model_v4  The bfactor is the plDDT in AlphaFold and the higher the more confident.  AlphaFold structures  have the feature of wiggly uncertain bits with a more certain core - aka there are  solved structures in the centre to learn from. This is interactive on the prometry app, you can move it about, zoom in and out etc...</p>"},{"location":"geometry/prometry/#validation","title":"Validation","text":"<p>Speaking of fun AlphaFold structures, the Ramachandran plots are interesting. The Validation page shows either the distribution of bond lengths for some of the key distances in the backbone, or overlays on an accpepted Ramachandran grid -  these plots for the same TP53 AlphaFold structure:  </p> <p> </p> <p> </p>"},{"location":"geometry/prometry/#criteria","title":"Criteria","text":"<p>The real reason for playing with geometry, is to be able to search for purportedly similar  features to examine the experimental evidence. Examples of interest include hydrogen bonds,  disulfide bonds and metal interactions. Below I look at the contacts between SG atoms  from the TP53 structures again <code>9C5S 3D06 5MHC 8UQR 6GGC 6SHZ 4MZI 6GGE 3LW1 5O1E 6RL3 8E7A</code> </p> <p>The plot shows the relationship between each SG and the nearest SG to it against the next-nearest.  That is those SG atoms in the very bottom left corner have 2 close SG contacts.  Note that this performs a space search and returns nearest on the given criteria,  optionally with constraints applied.  </p> <p> </p> <p>Note for this document I choose to display the results as an image but I have a dataframe  of results so I can use this to filter the obervations I want to use for further analysis.  </p> <p>The application is hosted for free by streamlit and a certain amount of fair use  is assumed.</p>"},{"location":"geometry/py-lib/","title":"Python Library - prometry","text":"<p>The geometry code is simply accessible in a python library <code>prometry</code>.  </p> <p>The library can be installed from PyPi with a simple pip install: <pre><code>pip install prometry\n</code></pre></p> <p>The code and documentation is available: -  GitHub: https://github.com/rae-gh/lib-prometry -  API Documentation: https://rae-gh.github.io/lib-prometry/ -  PyPi: https://pypi.org/project/prometry/ </p> <p>I have created a web application to interact with it in a non-coding way,  enabling you to create and explore correlations interactively,  see next page prometry-app</p>"},{"location":"geometry/tau/","title":"Tau and Bimodality","text":"<p>How can bimodal tau be a quesiton still?  </p> <p>note structure 1yk4 lit review claims tau and psi with 109.2 and 113.5  </p> <p>4rek looks at C: and CA:C:N+1 (tau + 1)</p>"},{"location":"interpolation/overview/","title":"Interpolation","text":""},{"location":"interpolation/results/","title":"Tri-linear interpolation","text":"<p>Compare this method: https://paulbourke.net/miscellaneous/interpolation/ against mine specifically for tri-linear interpolaiton.</p> <p>Also compare a wiki method for tri-cubic: https://www.paulinternet.nl/?page=bicubic</p>"},{"location":"maps/adjusted/","title":"Note to self","text":"<p>Using the c++ app, resurrect the translating util to prduce a new file with adjusted positions (online at bbk?)</p>"},{"location":"maps/density/","title":"Density","text":"<p>The file format used in this study is the ccp4 file format  which is industry standard for X-ray crystallogtraphy and Cryo-electron microscopy.</p> <p>The format is that of a 3d grid of voxels, each with a value corresponding to  density of electrons. The file is in a binary format, with a predefines set of headers  with information before the voxel information, the format is described  here MAPLIB.</p> <p>The crystal space is not necessarily orthogonal and needs to be mapped onto real space.  </p>"},{"location":"maps/density/#information-lost-with-information-gained","title":"Information lost with information gained","text":"<p>Before we explore the incredible detail of subatomic electron density measurements we should  take a moment to consider that information gained can coincide with information lost.  </p> <p>With the accuracy that we now have to identify the individual atoms in the  electron density by the strength of the density, we lose the average density over a range  which means we lose information about secondary structure. We can regain it, but it is not  quite the same as the information we previously had.  </p> <p>As an example below we have the projections of the density of the atoms of 2 structures: - 1ejg, as often used here because of the 3 disulfide bodns that are so distinctive, and its  ultrahigh solution at 0.54\u00c5 giving it samples as frequently as 0.18\u00c5 (Jelsch et al, 2000). - 6q53, solved at 3.70\u00c5 (Leiger et al, 2019).  </p> <p> </p> <p>On the first row - for 1ejg - you can see the sulfur atoms very clearly, and the distance  between them suggests they are disulfide bonds. If you look at the ribbon structure from  the 3d visualisation in the ebi that is on the xy plane you see that there are 2  prominent helices that are not identifiable.  </p> <p>On the otherhand, the low resolution structure 6q53 has clearly visible helices in the atoms  of the electron density that directly match up to the helices that can be seen in the ebi  3d visualisation. We can identify the secondary structures in otherways, but this loss is notable.  </p>"},{"location":"maps/density/#secondary-structure-and-density","title":"Secondary structure and density","text":"<p>We expect the density to be higher (and the bfactor lower) in secondary structures  within the protein because the atoms are \"moving\" less, they are in an ordered position.  Where the atoms are less stable and may \"move\" more (aka the position is more  varied so the average is spread out) the density is lower and the bfactor is higher.  With high resolution structures, as well as the average position we also have the  literal number of electrons to take into account, ie sulfur has a much higher  electron density than hydrogen. </p>"},{"location":"maps/density/#artefacts-and-uncertainty-rings","title":"Artefacts and uncertainty - rings","text":"<p>Because we can measure things in ultra-high resolution structures that are much finer,  we need to be careful about artefacts. There is a particular artefact in ultra-high  resolution structures that is particularly problematic - the ring artefact.  </p> <p>This is known from Afonine (2004) and yet somehow has never been fully taken on board -  paper after paper continues to make inferences based on potential artefacts highlighted  in that paper (see my literature review).  </p> <p>In summary, during conversion between various fourier sequences, an infinite sequence has  to be cut off. The impact of the cutoff is resolution dependent, and it just so happens  that in ultrahigh solutions the impact is at about 0.6\u00c5 - midway in a bond. It is the  information in bonds that are of particular interest in ultra-high structures, with many  papers purporting to be able to \"see\" bond electrons, so ...  </p> <p>For ejg I have each of the disulfide bonds below (O on the plane), with the density  increased and using a heatmap with 200 samples to improve focus.  The SG atoms are stronger in density so the effect is most pronounced with them,  but you can see that the ring effect is prevalent. </p> <p></p> <p>I would be concerned about making too many inferences about anything on the rings. The value of the rings is roughly similar in magnitude to what we could be looking  for in terms of bond electrons.</p>"},{"location":"maps/density/#difference-density","title":"Difference density","text":"<p>According to Afonine (2004) the problem with the rings goes away with difference density  where the rings are \"balanced\". I am suspicious of this and of difference density in general  but include it here for completeness.  </p> <p></p> <p>I say I am suspicious and then produce a textbook perfect image of difference density.  This shows the SG atom in CYS residue 3, in plane with its O and the disulfide bond  with residue 40.  It shows that the density in the model is not the observed density,  so we are drawn to make inferences about reality by seeing how reality differs from  expectations. If expectations had been a spherical atom model with even density around  the sulfur atom, we are seeing that in fact the electrons are distributed in a more lobe  like effect. I am not convinced, to me this is far too sensitive to the model,  which was made up in the first place.  </p> <p>There is some element of luck in the plane chosen - this can be explored in 3d on the associated colab page.  </p>"},{"location":"maps/density/#em-potential","title":"EM Potential","text":"<p>So, I don't like the rings and I don't like difference density: happily we can explore an  entirely different solution to structures which do not have these features in em structures.  They have neither the ring artefacts as the solution does not involve these fourier transforms,  nor the difference density as the solution is direct and does not require the iteration to a model. </p> <p>It would be reasonable to assume that if there are any real features in the bonds  observable at ultrahigh resolution, they would be observale in electron crystallography too.  </p> <p>The structure 7uly (Clabbers et al, 2022) is solved by electron crystallography at 0.87\u00c5 and has 129 residues.  There are 4 disulfide bonds so I will do the same analysis as for 1ejg with the first 3:</p> <p> </p> <p>You can see that the density is very different in character - let's look at some peptide bonds.  </p> <p> </p> <p>There is some clarity in the images and distinctly changing nature between the bonds as  we would hope, with a changing nature in electron dstribution between C:N+1 and O -  my particular interest.</p>"},{"location":"maps/density/#neighbours","title":"Neighbours","text":"<p>The final example on the colab page shows that neighbours can be added to interactive plots like plotly easily, so when you waive the mouse over the plot you can identify the atoms. More advanced programmatic use can be made of this, and it can be quite computationally intense as it is not well optimised and performs a pretty full search.</p>"},{"location":"maps/density/#_1","title":"Density","text":""},{"location":"maps/density/#colab-page-to-replicate","title":"Colab Page to replicate","text":"<p>All the plots can be run from the colab example found here:  colab-maps-density</p>"},{"location":"maps/gaussian/","title":"Note to self","text":"<p>Using the c++ app? where did I write the code to show gaussian interference? Was it in C#?</p>"},{"location":"maps/laplacian/","title":"The Laplacian - the 2nd derivative","text":"<p>The Laplacian is an important concept in charge density analysis. Pinoneered by Bader (1994),  in his Theory of Atoms in Molecules the  topological analysis of electron density through the Laplacian remains a popular analysis  in ultrahigh resolution structure determination.  </p> <p>The laplacian of electron density is the sum of the diagonal elements of the second  derivative matrix, or the trace of the hessian.  </p> <p>There is a nice document here about charge density analysis from Glasgow University,  Topological Analysis of Electron Density (Faurrugia, 2007).  </p> <p>My Laplacian is simply a 2nd partial derivative, and is not very illuminating because  it so closely matches the density itself. I use a hue that has 0 as a middle and red and  blue on the extremes (as I do with difference density) so that the features of the 2nd  derivative as -ve or +ve are clear.  </p>"},{"location":"maps/laplacian/#the-laplacian-of-the-disulfide-bonds","title":"The laplacian of the disulfide bonds","text":"<p>If I look at the 2nd partial derivatives of the disulfide bonds in 1ejg, and compare them  to the density, it would be hard not to be concerned about the rings.</p> <p></p> <p>And yet, can we dismiss it entirely? There are clear volumes of deeper density in specific  locations around the atoms - is it the product of overlapping rings or real information?  </p> <p>A challenge would be to remove the rings - what has held me back so far is the fear of adding  layer upon layer of artifical interpretation and having no idea what is really left at the end.  </p>"},{"location":"maps/laplacian/#the-laplacian-of-an-electron-crystallograhy-structure","title":"The laplacian of an electron crystallograhy structure","text":"<p>If we add the laplacian to the density and radient of the 7uly peptide bonds we have calculated  I am a little intrigued:</p> <p> </p> <p>Now we have no rings and no model bias, and distinctive differences in the character of electron  distribution in the peptide plane.  </p> <p>Discussions about Gaussian interference are coming up ahead, however.  </p>"},{"location":"maps/laplacian/#critical-point-definitions","title":"Critical point definitions","text":"<p>The laplacian is the diagonal of the Hessian, which is the sum of the 2nd partial derivatives.  For all critical points, the signature of the critical point is the number of -ve or +ve 2nd  derivatives. If it is a stable critical point it will have a rank of 3, that is 3 real eigenvalues. The signs of the eigenvalues define it's signature, where: - (3,-3) All negative eigenvalues - a local maxima - (3,-1) 2 negative, 1 positive - a bond cp - (3,+1) 1 negative, 2 positive - a ring cp - (3,+3) All positive, a local minimum - a cage cp </p> <p>We can use a simplified numerical scheme to itemise these as our values.  I have called this \"derivative\" the criticalpoint - it involves both the radient and the  laplacian for calculation so is more time-consuming. Where the (g)radient is not close to 0  the colour is 0, so there is a 5 colour scheme: - -3 -&gt; (3,-3) = dark red - -1 -&gt; (3,-1) = pink -  0 -&gt; NA     = black - +1 -&gt; (3,+1) = pale blue   - +3 -&gt; (3,+3) = dark blue   </p> <p></p> <p>The image is greyed out where there is not a critical point. However this can lead to a very  sparse image, so the arbitrary decision is made to categorise &lt;0.75 as a critical point  for the purpose of visualsation. As most of an atom is not at a critical point, this leads  largely to the atoms themselves being greyed out - with the background a bit more noisy.  Within the atoms you can see clearly the crtitical points and their signatures.  Quite satisfactory for this structure: - all the atom positions are at maxima - 2 of the C=O bonds have a bond critical point - 2 of the C=O bonds have a ring critical point  </p>"},{"location":"maps/laplacian/#a-tyrosine-ring","title":"A tyrosine ring","text":"<p>Because it is always nice to have the large plane of a tyrosine ring, I have the 4 derivatives  for residue 44 in the crambin structure 3nir. 3nir is even higher resoluton than 1ejg at  0.48\u00c5 (Schmidt et al, 2011).  I left the atom positions on the density image but removed them from  the others so they don't obscure anything.  </p> <p></p> <p>I increased the samples to 120 to get a clear image as the width is 9\u00c5. </p> <p>Orientation of above is:  </p> <p></p>"},{"location":"maps/laplacian/#colab-page-to-replicate","title":"Colab Page to replicate","text":"<p>All the plots can be run from the colab example found here:  colab-maps-laplacian</p>"},{"location":"maps/leuci-cpp/","title":"Note to self","text":"<p>Resurrect the c++ utility and provide examples. Put it into a docker/singularity container</p>"},{"location":"maps/leuci-web/","title":"Web applications for density exploration","text":""},{"location":"maps/leuci-web/#django-python-app","title":"django-python app","text":"<p>There is a django-framework web application available to explore the density interactively.  This is not satsifactory as it is not fast enough, unnecessary, overengineered and I can't afford to  host it anywhere sensible.  However it is really useful for exploration. I am most likely to run it locally. </p> <p>Here it is on a free tier on azure - maptial@azure</p> <p>The primary usefulness of the web app over the colab pages for specific analyses and images,  is the ability to navigate and explore. I am particularly pleased with the navigation panel  that allows orthogonal movement in space, plus tilts on all axes and the plane.  The yellow dots are the position dots on the plane - they go cyan when they are forward of the plane and line green when behind.  Because this is written in djanjo there is considerable work on both the client and server,  and with javascript and python to optimise as much as possible - caching in javascript when a  calculation is not necessary e.g. the changing of the hue. Quite unnecessary but quite fun.  </p> <p> Structure 2bf9</p>"},{"location":"maps/leuci-web/#python-app-as-a-docker-image","title":"python-app as a docker image","text":"<p>The image is on dockerhub at raea/maptial. It can be downloaded and run with docker, it will use it's own internal fileset which will not  persist when the image is destroyed, for pdb and ccp4 files:</p> <p>If you run the below from a command line it will pull it the first time:</p> <pre><code>docker run -p 8000:8000 raea/maptial\n</code></pre> <p>This will then run on the localhost and can be found at: http://localhost:8000</p>"},{"location":"maps/leuci-web/#c-web-application","title":"C# web application","text":"<p>Before the python webapp, there was a .net C# version. Before that there was a fully fledged windows C# application. The windows applicaiton was substantially faster, the web is not a good medium for the data and numerical intensity of the calculations, but it is the easiest to use for distribution.  To mess about with C# I need to use my windows laptop and Visual Studio rather than VSCode.  The main interest of the C# applicaiton was it integrated a neighbours search (you could hover over and see what the closest residue was in space) and it did some superposition. I elect to deprecate this now.  </p>"},{"location":"maps/leuci-web/#c-web-applicaiton","title":"C++ web applicaiton","text":"<p>Until the day this gets turned off, because I would not be able to resurrect the code, an early version of some of the electorn density code in C++ is hosted at Birkbeck via a CGI webserver, using python to call the C++ executable. One day someone will realise, until then:  Leucippus@Birkbeck </p>"},{"location":"maps/overview/","title":"Electron Density Maps","text":"<p>The primary purpose of my PhD is to look for new information about inter-atomic bonds from ultra-high resolution x-ray crystallographic maps. The explosion in the solutions of ultra-high resolution structures has led to information about protein crystal structures being sampled up to every 0.3\u00c5 in ultra-high structures.  </p>"},{"location":"maps/overview/#mesh-like-electron-density","title":"Mesh-like electron density","text":"<p>Traditional electron density is visualised in applications like ChimeraX, FirstGlance@Proteopedia or at the respositories like EBI as mesh-type structures based on standard deviatons.</p> <p> </p> <p>You can see from this image that the electron density doesn't cover the structure - this is how things seem to come by default now. All the deposited electron density at the EBI has been slowly changed over the past couple of years to be unit cell instead of structure coverage. It has broken lots of courses and it was a lot of work for me but my electron density applications were updated to take this into account.  </p> <p>An example from my application maptial below demonstrates how the new deposited density (on the top row below) is not necessarily contiguous with the structure - with my adjustments to make the density cover the structure on the row below.</p> <p> Structure 2bf9 (Glover et al, 1983)</p>"},{"location":"maps/overview/#probability-contour-electron-density","title":"Probability contour electron density","text":"<p>An example of the early sketches of electron density can be seen in Kathleen Lonsdale's solution to  Hexachlorobenzene (Lonsdale, 1931). </p>"},{"location":"maps/overview/#maxima-and-electron-density","title":"Maxima and electron density","text":"<p>When experimental evidence for atom position is discussed, there is consensus that the  experimental evidence means density peaks. According to Wlodawer (2007) the electron density is the final arbiter.  </p> <p>What does this really mean? There is no consensus on what the statistical variation or movement variation  means wrt atom position as experimental evidence. Stereo-chemical restraints are applied to force  atom positions into line, but not necessarily with explanation or record as to deviation from evidence.  </p> <p>The technique I have used to analyse electron density (and Cryo-EM and Electron Crystallography potential)  is numerical such that I can normalise and superpose. I use the raw values in the electron density to interpolate,  visualise and differentiate.</p> <p>This leads to probability density and contour maps more similar to those of Kathleen Lonsdale than ChimeraX.  In this image I have taken visualisations of peptide bonds from crambin, the same structure as above from the ebi mesh.  I have chosen to display 4 peptide bonds in a row to show the changing nature of them.  </p>"},{"location":"maps/overview/#3-points-for-a-plane","title":"3 points for a plane","text":"<p>The yellow dots on the images above are the points that I have taken to define the plane.  In this case they are specific points in the structure that I have chosen to put all the images in the same alignment: - C in the centre - CA linear, that is vertically above the C - O on the plane, wherever it needs to be, it swivels up onto the right hand side.  </p> <p>This forces those atoms onto the plane, I could have chosen N+1 instead,  although it is pretty much expected to be on the plane and we can measure where it is not  (see geometry library).  </p> <p>In the depth image coming up, I choose n samples either side of the plane.  </p> <p>I can also adjust to the closest maxima for alignment. This is a form of image registration,  where I am choosing the maxima to align the image, I could (and might) make a volumetric  decision instead for alignment, or some other method.  </p> <p>You can perhaps see, and could if you played with the volume slider on the web app,  that the atom positions are not necessarily quite at the density maxima.</p> <p>The alignment is done by finding a transformation for the given plane to the origin and  the xy plane, and using that transformation for all points. Once found, this transformation  can be used to manipulate through space moving orthoginally.  This feature is used in the web-app to navigate around.  </p>"},{"location":"maps/overview/#3d-slices","title":"3d slices","text":"<p>Although I like the planar slices for their clarity, you cannot be quite sure without  inspection what you are seeing, so the 3d slices add further information. Taking one of the peptide bonds above:  </p> <p>However I do find this quite hard to understand and navigate so prefer my ability to navigate around  the planar slices in my web-app.  </p>"},{"location":"maps/overview/#colab-page-to-replicate","title":"Colab Page to replicate","text":"<p>All the plots can be run from the colab example found here:  colab-maps-intro</p>"},{"location":"maps/py-lib/","title":"Python library <code>maptial</code>","text":"<p>All python libraries have been tied up together in a single library called <code>maptial</code>  for protein density maps spatial and geometric analysis.  This combines the geometric  parameters for correlation with density analysis and is installable from pypi:</p>"},{"location":"maps/py-lib/#installation","title":"Installation","text":"<pre><code>pip install maptial\n</code></pre>"},{"location":"maps/py-lib/#documentation","title":"Documentation","text":"<p>The code is available on GitHub </p> <p>The documentation is automatically generated from the code  docstrings by PyDoctor </p> <p>Examples of using the library for results can be found in jupyter notebooks that can be  opened on google-colab on GitHub colab-analyses </p>"},{"location":"maps/py-lib/#an-example","title":"An example","text":"<p>An example below shows the call to find a slice of density inside a protein structure  by requesting a plane containing 3 specified atoms from the pdb structure.  The resulting 2d slice of density numbers is passed to a helper function for plotting.  </p> <p>The points used to define the plane are plotted as yellow dots, and the resulting image  is a contour plot with predefined colours. The 2dmatrix can be plotted however you like,  the helper functions use predefined settings based on analysis and personal preference.  This colour scheme has greys below 0, and is designed to pick out atoms in red and increasing  density towards the atoms in blue-&gt;red.  </p> <p>This example puts the carbonyl atom of the 5th residue at the centre of the plane,  with the CA carbon atom of the same residue linearly above it. It puts onto the plane the  N atom of the 6th residue, so it is showing the peptide bond between the 5th and 6th residues.  </p> <p>The library takes spatial coordinates for the plane definitions, and contains helper  functions to translate pdb atom positions into spatial coordinates. Here, the atoms have been defined by <code>chain:residue@atom.version</code>.  </p> <p><pre><code>from maptial.xyz import vectorthree as v3\nimport maptial.map.mapsmanager as mman\nimport maptial.map.mapfunctions as mfun\nimport maptial.map.mapplothelp as mph\n\nDATADIR = \"sample_data/\" # the pdb and ccp4 files are downloaded here\npdb_code = \"7uly\"\ncentral_atom = \"A:5@C.A\"\nlinear_atom = \"A:5@CA.A\"\nplanar_atom = \"A:6@N.A\"\ninterpolation = \"bspline\"\nwidth = 4.5 # Angstrom\nsamples = 50 # More samples is sharper but slower\nderivative = 0 # 0 for density, 1 2 for 1st and 2nd derivative 3 for critical points\n\nmman.MapsManager().set_dir(DATADIR)\nml = mman.MapsManager().get_or_create(pdb_code,file=1,header=1,values=1)\nmf = mfun.MapFunctions(pdb_code,ml.mobj,ml.pobj,interpolation)\nslice_vectors = []\n\ncc = v3.VectorThree().from_coords(ml.pobj.get_coords_key(central_atom))\nll = v3.VectorThree().from_coords(ml.pobj.get_coords_key(linear_atom))\npp = v3.VectorThree().from_coords(ml.pobj.get_coords_key(planar_atom))\nslice_vectors.append((cc,ll,pp))  \n\nfilename = \"SHOW\" # if a filename is specified with .html it will be saved instead of shown\nvals2d = mf.get_slice(cc,ll,pp,width,samples,interpolation,deriv=derivative,ret_type=\"2d\")\nmplot = mph.MapPlotHelp(filename)\nmplot.make_plot_slice_2d(vals2d,min_percent=1,max_percent=0.9,samples=samples,width=width,points=[cc,ll,pp],title=pdb_code)\n</code></pre> Resulting image:  </p> <p></p>"},{"location":"maps/radient/","title":"Radient - a 1st Derivative","text":""},{"location":"maps/radient/#the-term-radient","title":"The term 'radient'","text":"<p>I coined the term 'radient' to describe a form of volumetric 1st derivative. The name derives  from 'gradient' without the 'g' - and is named because it describes the particular feature of 1st  derivatives of volumetric spheres where radial lines eminate from the maxima positions.  </p> <p>The use of arbitrary grid lines is not popular in physical interpretation - yet it  provides an incredibly handy visual guide for the literal direction to the maxima and is  therefore of great practical use in this circumstance.  </p> <p>Additionally, the saddle points of the bonds between atoms are also displayed with radial  lines. These guiding lines to the interpretation of the features of the electron density  maps complement the existing analysis where the Laplacian 2nd derivative is favoured  for the identification of important features in electron density (Bader, 1994).</p> <p>The radient is the l1 norm of del, derived from the 1st partial derivatives.  Or, it is the absolute value of the sum of the 1st partial derivatives.  I could lose the radient lines and be more standard by using the square of the sum of the  1st partial derivatives, but I have found the radient lines to be valuable in interpretation.  Particularly when navigating through density space to search for features.  </p>"},{"location":"maps/radient/#an-atom-picture-to-help","title":"An atom picture to help","text":"<p>This shows the orientation of the images below. </p>"},{"location":"maps/radient/#interpreting-the-radient-lines","title":"Interpreting the radient lines","text":"<p>In the image below I have used the same peptide bonds as per the overview images of crambin,  1ejg - an ultra high resolution structure at 0.54\u00c5 (Jelsch et al, 2000).</p> <p></p> <p>Some clear features are shown that are particular to the radient images: - In residue 7 the atom positions deposited are evidently not at the maxima for C and O. - In residue 8 the peptide plane is evidently not planar as N+1 is not on the plane (the maxima is not visible).  </p>"},{"location":"maps/radient/#visual-decisions-for-interpretation","title":"Visual decisions for interpretation","text":"<p>I have used an esoteric pallette of my choice for the density visualisation and stuck to a  standard black and white for the density. I have also used contour maps for the  density but heatmaps for the radient.  </p> <p>These choices are made following substantial investigation, and include settings to dial  the limits at the upper and lower end to increase the appearance of density in the correct range.  The density also has a setting of 0, with grey below 0 and the blue-&gt;red clour scale above.  There should not be negative density.  </p> <p>The radiant is a straight scale, where 0 as a first derivative has no specific meaning  (it does for the Laplacian) and the contours distract from the radient lines if included.  </p> <p>In order to achieve the level of sharpness I needed for the heatmaps I had to increase  samples in the density images to 100, whereas with the less sensitive density contour  plots I could use 50 - this has significant time savings.  </p> <p>For both these images I am using a bspline interpolation method, for rapid  navigation to seek information I would choose density:contours:linear:50, and only for the  verification of thought or the production of images might I increase to the more numerically  intense bspline at higher sampling.  </p>"},{"location":"maps/radient/#the-elctron-crystallography-structure-7uly","title":"The elctron crystallography structure 7uly","text":"<p>Having produced 4 peptide bond density images fopr the high res eletron crystallogrpahy  strucure 7uly (0.87\u00c5) I have the radient images too:  </p> <p> </p> <p>These images are suggestive of a lower resolution than 1ejg (0.54\u00c5 vs 0.87\u00c5 but it seems like more).  The electron density in the peptide plane across C:O:N+1 of the 7th residue glutamate  suggests something interesting in terms of electorn distribution - distinct from the others.  </p>"},{"location":"maps/radient/#colab-page-to-replicate","title":"Colab Page to replicate","text":"<p>All the plots can be run from the colab example found here:  colab-maps-radient</p>"}]}